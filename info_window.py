import customtkinter as CTk
import re


def show_info_window(parent):
    info_window = CTk.CTkToplevel(parent)
    info_window.title("Информация о ГОСТах")
    info_window.geometry("900x700")
    info_window.configure(fg_color="#E6E6FA")
    info_window.resizable(False, False)

    # Окно появится на переднем плане, но не будет оставаться всегда сверху
    info_window.attributes("-topmost", True)
    info_window.after(100, lambda: info_window.attributes("-topmost", False))

    # Добавляем надпись перед текстовым окном
    header_label = CTk.CTkLabel(info_window, text="Перечень проверяемых пунктов ГОСТ", font=("Arial", 30, "bold"))
    header_label.pack(pady=(10, 0))

    # Создаем CTkTextbox для отображения текста с возможностью прокрутки
    info_textbox = CTk.CTkTextbox(info_window, width=880, height=680, font=("Arial", 14), wrap='word',
                                  fg_color="#E6E6FA")
    info_textbox.pack(padx=10, pady=10)

    # Получаем доступ к внутреннему виджету Text из Tkinter
    tk_text_widget = info_textbox._textbox

    # Создаем теги для разных стилей
    tk_text_widget.tag_configure('heading', font=("Arial", 20, "bold"))
    tk_text_widget.tag_configure('normal', font=("Arial", 20))
    tk_text_widget.tag_configure('list_item', font=("Arial", 20))

    # Определяем список абзацев
    text_paragraphs = [
        "1 Обязательными структурными элементами отчета о НИР являются:",
        "- содержание;",
        "- введение;",
        "- заключение.",
        "2 Общие требования",
        "Цвет шрифта должен быть черным, размер шрифта - не менее 12 пт, интервал - 1,5. Рекомендуемый тип шрифта для основного текста отчета - Times New Roman.",
        "Текст отчета следует печатать, соблюдая следующие размеры полей: левое - 30 мм, правое - 15 мм, верхнее и нижнее - 20 мм. Абзацный отступ должен быть одинаковым по всему тексту отчета и равен 1,25 см.",
        "3 Нумерация страниц отчета",
        "Номер страницы проставляется в центре нижней части страницы без точки.",
        "Титульный лист включают в общую нумерацию страниц отчета.",
        "4 Списки",
        "Внутри пунктов или подпунктов могут быть приведены перечисления. Перед каждым элементом перечисления следует ставить тире. При необходимости ссылки в тексте отчета на один из элементов перечисления вместо тире ставят строчные буквы русского алфавита со скобкой, начиная с буквы \"а\" (за исключением букв ё, з, й, о, ч, ъ, ы, ь). Простые перечисления отделяются запятой, сложные - точкой с запятой.",
        "При наличии конкретного числа перечислений допускается перед каждым элементом перечисления ставить арабские цифры, после которых ставится скобка.",
        "Перечисления приводятся с абзацного отступа в столбик.",
        "5 Иллюстрации",
        "Иллюстрации (чертежи, графики, схемы, компьютерные распечатки, диаграммы, фотоснимки) следует располагать в отчете непосредственно после текста отчета, где они упоминаются впервые, или на следующей странице (по возможности ближе к соответствующим частям текста отчета). На все иллюстрации в отчете должны быть даны ссылки. При ссылке необходимо писать слово \"рисунок\" и его номер, например: \"в соответствии с рисунком 2\" и т.д.",
        "Иллюстрации, за исключением иллюстраций, приведенных в приложениях, следует нумеровать арабскими цифрами сквозной нумерацией. Если рисунок один, то он обозначается: Рисунок 1.",
        "Иллюстрации при необходимости могут иметь наименование и пояснительные данные (подрисуночный текст). Слово \"Рисунок\", его номер и через тире наименование помещают после пояснительных данных и располагают в центре под рисунком без точки в конце.",
        "6 Таблицы",
        "Таблицу следует располагать непосредственно после текста, в котором она упоминается впервые, или на следующей странице. На все таблицы в отчете должны быть ссылки. При ссылке следует писать слово \"таблица\" с указанием ее номера.",
        "Наименование таблицы, при ее наличии, должно отражать ее содержание, быть точным, кратким. Наименование следует помещать над таблицей слева, без абзацного отступа в следующем формате: Таблица Номер таблицы - Наименование таблицы. Наименование таблицы приводят с прописной буквы без точки в конце.",
        "Таблицы, за исключением таблиц приложений, следует нумеровать арабскими цифрами сквозной нумерацией."
    ]

    # Вставляем текст с применением стилей
    for paragraph in text_paragraphs:
        # Убираем ведущие и завершающие пробелы
        paragraph = paragraph.strip()
        # Определяем стиль на основе содержания абзаца
        if re.match(r'^\s*\d+(\.\d+)*', paragraph):  # Начинается с числа
            tag = 'heading'
        elif re.match(r'^\s*-\s*', paragraph):  # Начинается с дефиса
            tag = 'list_item'
        else:
            tag = 'normal'

        # Получаем индекс до вставки текста
        start_index = tk_text_widget.index('end-1c')
        # Вставляем текст
        tk_text_widget.insert('end', paragraph + '\n\n')
        # Получаем индекс после вставки текста
        end_index = tk_text_widget.index('end-1c')
        # Применяем тег форматирования к вставленному тексту
        tk_text_widget.tag_add(tag, start_index, end_index)

    # Делаем текстовое поле только для чтения
    info_textbox.configure(state="disabled")

    # Обработка прокрутки колесиком мыши
    def _on_mousewheel(event):
        tk_text_widget.yview_scroll(int(-1 * (event.delta / 120)), "units")

    tk_text_widget.bind("<Enter>", lambda e: tk_text_widget.bind_all('<MouseWheel>', _on_mousewheel))
    tk_text_widget.bind("<Leave>", lambda e: tk_text_widget.unbind_all('<MouseWheel>'))
